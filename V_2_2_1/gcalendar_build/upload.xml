<project name="upload to ftp" default="upload" basedir=".">
	<taskdef resource="net/sf/antcontrib/antcontrib.properties" />
	<description>
		automated upload to gcalendar servers
		usage ant upload -propertyfile upload_xxx.properties
    </description>

	<property name="build" location="build" />

	<target name="upload">
		<antcall target="clean" />
		<antcall target="upload15" />
	</target>

	<target name="upload15" description="uploads gcalendar 1.5 to the ftp server">
		<if>
			<istrue value="${upload15}" />
			<then>
				<antcall target="prepare_1_5_for_upload">
					<param name="dir" value="${build}/upgrade_1_5" />
				</antcall>
				<ftp server="${server_url15}" userid="${username15}" password="${password15}" remotedir="${remote_root_dir15}" passive="yes" binary="no" verbose="yes">
					<fileset dir="${build}/upgrade_1_5" />
				</ftp>
			</then>
			<else>
				<echo message="Not executing upload for 1.5" />
			</else>
		</if>
	</target>

	<target name="prepare_1_5_for_upload" description="prepare the dir structure to be ready to upload in a joomla 1.5 environment">
		<if>
			<istrue value="${upload15.com_gcalendar}" />
			<then>
				<!-- create com_gcalendar dir tree structure package -->
				<copy todir="${dir}/administrator/components/com_gcalendar">
					<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/admin">
						<exclude name="**/languages/" />
						<exclude name="**/images/" />
						<exclude name="**/css/" />
						<exclude name="**/libraries/" />
					</fileset>
				</copy>
				<copy file="${basedir}/../Joomla_1_5_x/com_gcalendar/gcalendar.xml" todir="${dir}/administrator/components/com_gcalendar" />

				<if>
					<istrue value="${completeupload}" />
					<then>
						<copy todir="${dir}/administrator/language/en-GB">
							<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/admin/languages/" />
						</copy>
						<copy todir="${dir}/administrator/components/com_gcalendar">
							<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/admin">
								<include name="**/images/" />
								<include name="**/css/" />
								<include name="**/libraries/" />
							</fileset>
						</copy>
					</then>
				</if>

				<copy todir="${dir}/components/com_gcalendar">
					<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/site">
						<exclude name="**/languages/" />
						<exclude name="**/googlecal/" />
						<exclude name="**/img/" />
					</fileset>
				</copy>
				<if>
					<istrue value="${completeupload}" />
					<then>
						<copy todir="${dir}/language/en-GB">
							<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/site/languages/" />
						</copy>
						<copy todir="${dir}/components/com_gcalendar">
							<fileset dir="${basedir}/../Joomla_1_5_x/com_gcalendar/site">
								<include name="**/googlecal/" />
								<include name="**/img/" />
							</fileset>
						</copy>
					</then>
				</if>
			</then>
			<else>
				<echo message="Not creating gcalendar dir for 1.5" />
			</else>
		</if>

		<if>
			<istrue value="${upload15.plg_gcalendar_search}" />
			<then>
				<copy todir="${dir}/plugins/search">
					<fileset dir="${basedir}/../Joomla_1_5_x/plg_gcalendar_search" />
				</copy>
			</then>
			<else>
				<echo message="Not creating search plugin dir for 1.5" />
			</else>
		</if>

		<!-- create the modules dir tree structure package -->
		<antcall target="create_module_upgrade_folder_1_5">
			<param name="module_name" value="mod_gcalendar" />
			<param name="cond" value="${upload15.mod_gcalendar}" />
		</antcall>
		<antcall target="create_module_upgrade_folder_1_5">
			<param name="module_name" value="mod_gcalendar_upcoming" />
			<param name="cond" value="${upload15.mod_gcalendar_upcoming}" />
		</antcall>
	</target>

	<target name="create_module_upgrade_folder_1_5">
		<if>
			<istrue value="${cond}" />
			<then>
				<copy todir="${dir}/modules/${module_name}">
					<fileset dir="${basedir}/../Joomla_1_5_x/${module_name}/">
						<exclude name="**/languages/" />
					</fileset>
				</copy>
				<if>
					<istrue value="${completeupload}" />
					<then>
						<copy todir="${dir}/language/en-GB">
							<fileset dir="${basedir}/../Joomla_1_5_x/${module_name}/languages/" />
						</copy>
					</then>
				</if>
			</then>
			<else>
				<echo message="Not creating ${module_name} dir for 1.5" />
			</else>
		</if>
	</target>

	<target name="clean" description="clean up">
		<!-- Delete the ${build} directory trees -->
		<delete dir="${build}" />
	</target>
</project>